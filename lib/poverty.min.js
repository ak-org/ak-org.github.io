function Interpolate(a,t,e,n){var r=a,o=r+(t-r)/e*n;return Math.floor(o)}function Color(a,t,e){var n,r,o;!function(a,t,e){n=a,r=t,o=e}(a,t,e),this.getColors=function(){return{r:n,g:r,b:o}}}function hexToRgb(a){var t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(a);return t?{r:parseInt(t[1],16),g:parseInt(t[2],16),b:parseInt(t[3],16)}:null}function reset(){active.classed("active",!1),active=d3.select(null),svg.transition().duration(750).call(zoom.transform,d3.zoomIdentity)}function stopped(){d3.event.defaultPrevented&&d3.event.stopPropagation()}function makeMap(a){var t=WIDTH,e=HEIGHT,n=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(a){var t=id_name_map[a.id];return"<span class='details'>"+t+"<br>Overall Poverty <span class='details'>"+poverty_data[t][3]+"%"}),r=(d3.scaleQuantize().domain([0,1]).range(d3.range(COLOR_COUNTS).map(function(a){return a})),d3.geoAlbersUsa().translate([250,150]).scale([550])),o=d3.geoPath().projection(r),i=d3.select(a).append("svg").attr("width",t/2).attr("height",e/2).on("click",stopped,!0);i.call(n),d3.json("https://s3-us-west-2.amazonaws.com/vida-public/geo/us.json",function(a,t){if(a)throw a;i.append("g").attr("class","states").selectAll("path").data(topojson.feature(t,t.objects.states).features).enter().append("path").style("fill",function(a){var t=id_name_map[a.id];if(void 0!=t)return poverty_data[t][3]<13?"rgb(0,100,0)":poverty_data[t][3]>12.5&&poverty_data[t][3]<15.9?"rgb(255,178,102)":"rgb(204,0,0)"}).on("mouseover",function(a,t){var e=id_name_map[a.id];$(this).attr("fill-opacity","0.8"),void 0!=e&&(d3.select(this).style("fill-opacity",.6),n.show(a))}).on("mouseout",function(a,t){d3.select(this).style("fill-opacity",1),n.hide(a)}).on("click",function(a,t){var e=id_name_map[a.id];console.log("You clicked on ",e),makeBar(".chart1",e),makeBar2(".chart2",e)}).attr("d",o),i.append("path").attr("class","state-borders").attr("d",o(topojson.mesh(t,t.objects.states,function(a,t){return a!==t})))})}function makeBar(a,t){var e=HEIGHT,n={top:20,right:20,bottom:30,left:40},r=[poverty_data[t][0],poverty_data[t][1],poverty_data[t][2],poverty_data[t][3]],o=["0 - 5 Years ","0 -17 Years ","5 - 17 Years ","Overall "],i=[" rgb(255,112,11)","rgb(144,18,41)","rgb(32, 127, 66)","rgb(65, 100, 127)"];d3.scaleBand().range([e,0]).padding(.1).domain(r.map(function(a,t){return console.log(a,t,o[t]),o[t]}));var s=d3.select(".svgBar"),l=d3.scaleOrdinal().domain(o).range(i);console.log("Create a Poverty Bar chart for state for ",t),d3.select("#barTitle1").html("Poverty Level in <strong>"+t+"</strong> for various age groups"),d3.select(a).selectAll("div").data(r).enter().append("div").style("width",function(a){return 8*a+"px"}).style("background-color",function(a,t){return i[t]}).text(function(a,t){return a+"%"}).exit().transition().style("opacity",0).attr("transform","translate(0,"+(e+n.top+n.bottom)+")").remove(),d3.select(".chart1").selectAll("div").transition().duration(600).text(function(a,t){return a+"%"}).style("width",function(a){return 8*a+"px"}),s.append("g").attr("class","legendOrdinal").attr("transform","translate(20,100)");var c=d3.legendColor().shape("path",d3.symbol().type(d3.symbolSquare).size(500)()).cells(4).shapeWidth(60).orient("vertical").scale(l);s.select(".legendOrdinal").call(c)}function makeMap2(a){var t=WIDTH,e=HEIGHT,n=d3.tip().attr("class","d3-tip").offset([-10,0]).html(function(a){var t=id_name_map[a.id];return"<span class='details'>"+t+"<br>Mortality Rate <span class='details'>"+overall_rate[t]+" / 100K Adults"}),r=(d3.scaleQuantize().domain([0,1]).range(d3.range(COLOR_COUNTS).map(function(a){return a})),d3.geoAlbersUsa().translate([250,150]).scale([550])),o=d3.geoPath().projection(r),i=d3.select(a).append("svg").attr("width",t/2).attr("height",e/2).on("click",stopped,!0);i.call(n),d3.json("https://s3-us-west-2.amazonaws.com/vida-public/geo/us.json",function(a,t){if(a)throw a;i.append("g").attr("class","states").selectAll("path").data(topojson.feature(t,t.objects.states).features).enter().append("path").style("fill",function(a){var t=id_name_map[a.id];if(void 0!=t)return overall_rate[t]<290?"rgb(0,100,0)":overall_rate[t]>290&&overall_rate[t]<360?"rgb(255,178,102)":"rgb(204,0,0)"}).on("mouseover",function(a,t){void 0!=id_name_map[a.id]&&(console.log(a,t),d3.select(this).style("fill-opacity",.6),n.show(a))}).on("mouseout",function(a,t){console.log(a,t),d3.select(this).style("fill-opacity",1),d3.select(this).style("zoom",1),n.hide(a)}).on("click",function(a,t){var e=id_name_map[a.id];console.log("You clicked on ",e),makeBar2(".chart2",e),makeBar(".chart1",e)}).attr("d",o),i.append("path").attr("class","state-borders").attr("d",o(topojson.mesh(t,t.objects.states,function(a,t){return a!==t})))})}function populate_state_level_data(a){var t=[0,0,0,0,0,0],e=["Overall","Black","White","Hispanic","Asian and Pacific Islander","American Indian and Alaskan Native"],n=clean_hd_data;console.log(n.length);for(var r=0;r<n.length;r++)n[r].LocationDesc==a&&n[r].Stratification2==e[0]&&n[r].Stratification1==e[0]&&(t[0]=n[r].Data_Value),n[r].LocationDesc==a&&n[r].Stratification2==e[1]&&n[r].Stratification1==e[0]&&(t[1]=n[r].Data_Value),n[r].LocationDesc==a&&n[r].Stratification2==e[2]&&n[r].Stratification1==e[0]&&(t[2]=n[r].Data_Value),n[r].LocationDesc==a&&n[r].Stratification2==e[3]&&n[r].Stratification1==e[0]&&(t[3]=n[r].Data_Value),n[r].LocationDesc==a&&n[r].Stratification2==e[4]&&n[r].Stratification1==e[0]&&(t[4]=n[r].Data_Value),n[r].LocationDesc==a&&n[r].Stratification2==e[5]&&n[r].Stratification1==e[0]&&(t[5]=n[r].Data_Value);return t}function makeBar2(a,t,e){console.log("You clicked on ",t);var n=populate_state_level_data(t);console.log("Create a Mortality chart for state for ",t),d3.select("#barTitle2").html("Heart Disease Mortality Rate in <strong>"+t+"</strong> per 100K Adults");var r=d3.select(".svgBar2"),o=(parseInt(r.style("width"),10),parseInt(r.style("height"),10)),i={top:30,right:30,bottom:30,left:30},s=o-i.top-i.bottom,l=["Overall","Black","White","Hispanic","Asian and Pacific Islander","American Indian and Alaskan Native"],c=["rgb(255,112,11)","rgb(144,18,41)","rgb(32, 127, 66)","rgb(65, 100, 127)","#a05d56","\trgb(0,139,139)"],d=(d3.scaleOrdinal().range(["#98abc5","#8a89a6","#7b6888","#6b486b","#a05d56","#d0743c"]),d3.scaleOrdinal().domain(l).range(c)),p=d3.scaleBand().range([s,0]).padding(.1);p.domain(n.map(function(a,t){return console.log(a,t,l[t]),l[t]}));r.append("g").attr("transform","translate("+i.left+","+i.top+")"),p.domain(n.map(function(a){return a.race})),d3.select(a).selectAll("div").data(n).enter().append("div").style("width",function(a){return.7*a+"px"}).style("visibility",function(a){return a>0?"visible":"hidden"}).style("background-color",function(a,t){return c[t]}).text(function(a,t){return a.value}).exit().transition().style("opacity",0).attr("transform","translate(0,"+(s+i.top+i.bottom)+")").remove(),d3.select(".chart2").selectAll("div").transition().duration(600).text(function(a,t){return a}).style("width",function(a){return.7*a+"px"}).style("visibility",function(a){return a>0?"visible":"hidden"}),r.append("g").attr("class","legendOrdinal").attr("transform","translate(20,75)");var u=d3.legendColor().shape("path",d3.symbol().type(d3.symbolSquare).size(500)()).cells(6).shapeWidth(60).orient("vertical").scale(d);r.select(".legendOrdinal").call(u)}var WIDTH=960,HEIGHT=600,COLOR_FIRST="#3fae07",COLOR_LAST="#ff0404",COLOR_COUNTS=10,MAP1_TITLE="Poverty Rate (States)",MAP_VALUE_2="obese_children_and_adolescents_number",MAP2_TITLE="Heart Disease Mortality (35+ Adults)",SCALE=.5,active=d3.select(null),centered,state_names=["Alabama","Alaska","Arizona","Arkansas","California","Colorado","Connecticut","Delaware","District of Columbia","Florida","Georgia","Hawaii","Idaho","Illinois","Indiana","Iowa","Kansas","Kentucky","Louisiana","Maine","Maryland","Massachusetts","Michigan","Minnesota","Mississippi","Missouri","Montana","Nebraska","Nevada","New Hampshire","New Jersey","New Mexico","New York","North Carolina","North Dakota","Ohio","Oklahoma","Oregon","Pennsylvania","Rhode Island","South Carolina","South Dakota","Tennessee","Texas","Utah","Vermont","Virginia","Washington","West Virginia","Wisconsin","Wyoming"];name_id_map={},id_name_map={},poverty_data={},heart_disease_data={},overall_rate={},overall_rate_by_state=[],clean_hd_data=[],d3.tsv("/data/us-state-names.tsv",function(a,t){for(var e=0;e<t.length;e++)name_id_map[t[e].name]=t[e].id,id_name_map[t[e].id]=t[e].name});var processPovertyData=function(a,t){for(var e=hexToRgb(COLOR_FIRST),n=new Color(e.r,e.g,e.b),r=new Color((e=hexToRgb(COLOR_LAST)).r,e.g,e.b),o=n.getColors(),i=r.getColors(),s=[],l=0;l<COLOR_COUNTS;l++){var c=Interpolate(o.r,i.r,COLOR_COUNTS,l),d=Interpolate(o.g,i.g,COLOR_COUNTS,l),p=Interpolate(o.b,i.b,COLOR_COUNTS,l);s.push(new Color(c,d,p))}for(null!=a&&console.log(a),l=0;l<t.length;l++)name_id_map[t[l].Area_Name]&&(poverty_data[t[l].Area_Name]=[t[l].PCTPOV05_2015,t[l].PCTPOV017_2015,t[l].PCTPOV517_2015,t[l].PCTPOVALL_2015]);makeMap("#map1-svg",MAP1_TITLE),makeBar(".chart1","California")},processDiseaseData=function(a,t){if(null!=a)return a;for(i=0;i<t.length;i++){var e=t[i].LocationDesc;if(name_id_map[e]){var n=String(t[i].Stratification1),r=String(t[i].Stratification2),o=t[i].Data_Value;heart_disease_data[e+","+n+","+r]=o}}for(var i=0;i<state_names.length;i++){var s=state_names[i]+",Overall,Overall";overall_rate[state_names[i]]=+heart_disease_data[s]}clean_hd_data=t,makeMap2("#map2-svg",MAP2_TITLE),makeBar2(".chart2","California")};d3.csv("/data/PovertyEstimates.csv",processPovertyData),d3.csv("/data/clean_heart_disease.csv",processDiseaseData);